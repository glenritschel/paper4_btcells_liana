# Paper 4: B-T Cell Interactions in Systemic Sclerosis

[![Code DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.18643526.svg)](https://doi.org/10.5281/zenodo.18643526)
[![Manuscript DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.18643672.svg)](https://doi.org/10.5281/zenodo.18643672)

# Paper 4: B-T Cell Interactions in Systemic Sclerosis
## Overview

This repository contains all code and analysis for:

**"B Cell Activation Associates with Reduced Pro-Fibrotic T Cell Programs Despite Amplified Inflammatory Ligand Expression in Systemic Sclerosis: Evidence for Immunoregulatory Feedback"**

**Authors**: Glen Ritschel  
**Journal**: Frontiers in Immunology (submitted Feb 13, 2026)  
**Preprint**: [To be added]

## Key Finding

We discovered an unexpected **negative correlation** between B cell activation and pro-fibrotic T cell programs in systemic sclerosis:

- B cell activation vs Th2: Spearman r = -0.368, p = 2.089×10⁻¹⁰
- B cell activation vs Th17: Spearman r = -0.297, p = 3.995×10⁻⁷  
- Sample size: n = 280 patient samples

**Mechanism**: Activated B cells upregulate LGALS9 (Galectin-9, 1.3-fold) → TIM-3 signaling on T cells → T cell exhaustion/apoptosis

**Clinical relevance**: Explains modest efficacy of rituximab (B cell depletion) in SSc trials

## Repository Structure

```
paper4_btcells_liana/
├── scripts/           # All analysis scripts
│   ├── publication/   # Publication figure generation
│   ├── 01-09_*.py    # Main pipeline scripts
│   └── *.py          # Analysis utilities
├── configs/           # Analysis configuration
├── paper/            # Publication outputs
│   ├── figures/      # Final figures (PNG, PDF, JPG)
│   ├── supplementary/ # Excel tables
│   ├── manuscript/   # DOCX and PDF manuscript
│   └── submission/   # Submission records
├── results/          # Analysis results
│   ├── liana/        # LIANA interaction predictions
│   ├── sample_level_figures/  # KEY: Figure 3 (negative correlations)
│   └── amplification_q1q4_*/  # Ligand amplification
├── work/             # Intermediate data (not archived - too large)
├── environment.yml   # Conda environment
└── Makefile         # Automated pipeline
```

## Reproducibility

- Linux/macOS system
- Conda/Mamba package manager
- ~50 GB disk space (for raw data downloads)
- ~16 GB RAM minimum

### Setup

1. Clone repository:
```bash
git clone https://github.com/glritschel/paper4_btcells_liana.git
cd paper4_btcells_liana
```

2. Create environment:
```bash
conda env create -f environment.yml
conda activate paper4
```

3. Download public data:
```bash
python scripts/01_geo_download.py --dataset GSE195452
python scripts/01_geo_download.py --dataset GSE210395
```

### Run Full Pipeline

```bash
# Process data through full pipeline
make all

# This runs:
# - Quality control and filtering
# - Cell type annotation
# - B cell activation scoring
# - T cell program scoring  
# - LIANA ligand-receptor analysis
# - Ligand amplification quantification
# - Sample-level correlation analysis (KEY ANALYSIS)
```

### Generate Publication Figures

```bash
# Generate all figures from pipeline results
python scripts/publication/generate_all_publication_figures.py

# Output: paper/figures/Figure*.png, Figure*.pdf

# Convert to JPG for journal submission (if needed)
cd paper/figures
for f in Figure*.png; do
    convert "$f" -density 300 -quality 95 "${f%.png}.jpg"
done
```

### Key Analysis: Figure 3 (Negative Correlations)

The central discovery - negative B-T correlations - is generated by:

```bash
python scripts/run_correlation_analysis.py

# Reads: work/sample_level_analysis/gse195452_per_sample_bt_scores.tsv
# Computes: Spearman correlations per-sample
# Outputs: results/sample_level_figures/gse195452_b_activation_vs_t_programs.png/pdf
```

## Data Availability

**Public datasets** (GEO):
- GSE195452: https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE195452
- GSE210395: https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE210395

**Analysis results**:
- Supplementary Tables S1-S2 (paper/supplementary/)
- Complete LIANA results for B→T interactions

**Code**:
- This repository (GitHub + Zenodo archive)

## Citation

If you use this code or data, please cite:

```bibtex
@article{ritschel2026btcells,
  title={B Cell Activation Associates with Reduced Pro-Fibrotic T Cell Programs Despite Amplified Inflammatory Ligand Expression in Systemic Sclerosis: Evidence for Immunoregulatory Feedback},
  author={Ritschel, Glen},
  journal={Frontiers in Immunology},
  year={2026},
  note={Submitted}
}
```

**Code archive**:
```bibtex
@software{ritschel2026btcells_code,
  author = {Ritschel, Glen},
  title = {Paper 4: B-T Cell Interactions in Systemic Sclerosis - Analysis Code},
  year = {2026},
  publisher = {Zenodo},
  doi = {10.5281/zenodo.XXXXXXX},
  url = {https://doi.org/10.5281/zenodo.XXXXXXX}
}
```

## License

MIT License - see LICENSE file

## Contact

Glen Ritschel - [your email]

## Acknowledgments

- Data from GSE195452 and GSE210395 studies
- LIANA framework developers
- Scanpy/scverse ecosystem
- ChatGPT (code generation) and Claude (strategic guidance)

